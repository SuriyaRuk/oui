(window["visTypeVega_bundle_jsonpfunction"]=window["visTypeVega_bundle_jsonpfunction"]||[]).push([[2],{107:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"VegaParser",(function(){return vega_parser_VegaParser}));var external_osdSharedDeps_Lodash_=__webpack_require__(6);var external_osdSharedDeps_Lodash_default=__webpack_require__.n(external_osdSharedDeps_Lodash_);var dist_parser=__webpack_require__(79);var parser_default=__webpack_require__.n(dist_parser);var compare_versions=__webpack_require__(80);var compare_versions_default=__webpack_require__.n(compare_versions);var hjson=__webpack_require__(14);var hjson_default=__webpack_require__.n(hjson);var external_osdSharedDeps_ElasticEui_=__webpack_require__(1);var external_osdSharedDeps_Theme_=__webpack_require__(52);var external_osdSharedDeps_OsdI18n_=__webpack_require__(2);var vega=__webpack_require__(55);var external_osdSharedDeps_Moment_=__webpack_require__(49);var external_osdSharedDeps_Moment_default=__webpack_require__.n(external_osdSharedDeps_Moment_);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const TIMEFILTER="%timefilter%";const AUTOINTERVAL="%autointerval%";const MUST_CLAUSE="%dashboard_context-must_clause%";const MUST_NOT_CLAUSE="%dashboard_context-must_not_clause%";const FILTER_CLAUSE="%dashboard_context-filter_clause%";const LEGACY_CONTEXT="%context_query%";const CONTEXT="%context%";const TIMEFIELD="%timefield%";const getRequestName=(request,index)=>request.dataObject.name||external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.unnamedRequest",{defaultMessage:"Unnamed request #{index}",values:{index:index}});class opensearch_query_parser_OpenSearchQueryParser{constructor(timeCache,searchAPI,filters,onWarning){_defineProperty(this,"_timeCache",void 0);_defineProperty(this,"_searchAPI",void 0);_defineProperty(this,"_filters",void 0);_defineProperty(this,"_onWarning",void 0);this._timeCache=timeCache;this._searchAPI=searchAPI;this._filters=filters;this._onWarning=onWarning}parseUrl(dataObject,url){let body=url.body;let context=url[CONTEXT];delete url[CONTEXT];let timefield=url[TIMEFIELD];delete url[TIMEFIELD];let usesContext=context!==undefined||timefield!==undefined;if(body===undefined){url.body=body={}}else if(!Object(external_osdSharedDeps_Lodash_["isPlainObject"])(body)){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.urlBodyValueTypeErrorMessage",{defaultMessage:"{configName} must be an object",values:{configName:"url.body"}}))}const legacyContext=url[LEGACY_CONTEXT];delete url[LEGACY_CONTEXT];if(legacyContext!==undefined){if(body.query!==undefined){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.dataUrlMustNotHaveLegacyAndBodyQueryValuesAtTheSameTimeErrorMessage",{defaultMessage:"{dataUrlParam} must not have legacy {legacyContext} and {bodyQueryConfigName} values at the same time",values:{legacyContext:'"'.concat(LEGACY_CONTEXT,'"'),bodyQueryConfigName:'"body.query"',dataUrlParam:'"data.url"'}}))}else if(usesContext){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.dataUrlMustNotHaveLegacyContextTogetherWithContextOrTimefieldErrorMessage",{defaultMessage:"{dataUrlParam} must not have {legacyContext} together with {context} or {timefield}",values:{legacyContext:'"'.concat(LEGACY_CONTEXT,'"'),context:'"'.concat(CONTEXT,'"'),timefield:'"'.concat(TIMEFIELD,'"'),dataUrlParam:'"data.url"'}}))}else if(legacyContext!==true&&(typeof legacyContext!=="string"||legacyContext.length===0)){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.legacyContextCanBeTrueErrorMessage",{defaultMessage:"Legacy {legacyContext} can either be {trueValue} (ignores time range picker), or it can be the name of the time field, e.g. {timestampParam}",values:{legacyContext:'"'.concat(LEGACY_CONTEXT,'"'),trueValue:"true",timestampParam:'"@timestamp"'}}))}usesContext=true;context=true;let result='"url": {"'.concat(CONTEXT,'": true');if(typeof legacyContext==="string"){timefield=legacyContext;result+=', "'.concat(TIMEFIELD,'": ').concat(JSON.stringify(timefield))}result+="}";this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.legacyUrlShouldChangeToWarningMessage",{defaultMessage:"Legacy {urlParam}: {legacyUrl} should change to {result}",values:{legacyUrl:'"'.concat(LEGACY_CONTEXT,'": ').concat(JSON.stringify(legacyContext)),result:result,urlParam:'"url"'}}))}if(body.query!==undefined){if(usesContext){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.urlContextAndUrlTimefieldMustNotBeUsedErrorMessage",{defaultMessage:"{urlContext} and {timefield} must not be used when {queryParam} is set",values:{timefield:"url.".concat(TIMEFIELD),urlContext:"url.".concat(CONTEXT),queryParam:"url.body.query"}}))}this._injectContextVars(body.query,true)}else if(usesContext){if(timefield){body.query={range:{[timefield]:this._createRangeFilter({[TIMEFILTER]:true})}}}if(context){const newQuery=Object(external_osdSharedDeps_Lodash_["cloneDeep"])(this._filters);if(timefield){newQuery.bool.must.push(body.query)}body.query=newQuery}}this._injectContextVars(body.aggs,false);return{dataObject:dataObject,url:url}}async populateData(requests){const opensearchSearches=requests.map((r,index)=>({...r.url,name:getRequestName(r,index)}));const data$=this._searchAPI.search(opensearchSearches);const results=await data$.toPromise();results.forEach((data,index)=>{const requestObject=requests.find(item=>getRequestName(item,index)===data.name);if(requestObject){requestObject.dataObject.url=requestObject.url;requestObject.dataObject.values=data.rawResponse}})}_injectContextVars(obj,isQuery){if(obj&&typeof obj==="object"){if(Array.isArray(obj)){for(let pos=0;pos<obj.length;){const item=obj[pos];if(isQuery&&(item===FILTER_CLAUSE||item===MUST_CLAUSE||item===MUST_NOT_CLAUSE)){let ctxTag="";switch(item){case FILTER_CLAUSE:ctxTag="filter";break;case MUST_CLAUSE:ctxTag="must";break;case MUST_NOT_CLAUSE:ctxTag="must_not";break}const ctx=Object(external_osdSharedDeps_Lodash_["cloneDeep"])(this._filters);if(ctx&&ctx.bool&&ctx.bool[ctxTag]){if(Array.isArray(ctx.bool[ctxTag])){obj.splice(pos,1,...ctx.bool[ctxTag]);pos+=ctx.bool[ctxTag].length}else{obj[pos++]=ctx.bool[ctxTag]}}else{obj.splice(pos,1)}}else{this._injectContextVars(item,isQuery);pos++}}}else{for(const prop of Object.keys(obj)){const subObj=obj[prop];if(!subObj||typeof obj!=="object")continue;if(prop==="interval"&&subObj[AUTOINTERVAL]){let size=subObj[AUTOINTERVAL];if(size===true){size=50}else if(typeof size!=="number"){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.autointervalValueTypeErrorMessage",{defaultMessage:"{autointerval} must be either {trueValue} or a number",values:{autointerval:'"'.concat(AUTOINTERVAL,'"'),trueValue:"true"}}))}const bounds=this._timeCache.getTimeBounds();obj.interval=opensearch_query_parser_OpenSearchQueryParser._roundInterval((bounds.max-bounds.min)/size);continue}switch(subObj[TIMEFILTER]){case"min":case"max":obj[prop]=this._getTimeBound(subObj,subObj[TIMEFILTER]);continue;case true:this._createRangeFilter(subObj);continue;case undefined:this._injectContextVars(subObj,isQuery);continue;default:throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.timefilterValueErrorMessage",{defaultMessage:"{timefilter} property must be set to {trueValue}, {minValue}, or {maxValue}",values:{timefilter:'"'.concat(TIMEFILTER,'"'),trueValue:"true",minValue:'"min"',maxValue:'"max"'}}))}}}}}_createRangeFilter(obj){obj.gte=external_osdSharedDeps_Moment_default()(this._getTimeBound(obj,"min")).toISOString();obj.lte=external_osdSharedDeps_Moment_default()(this._getTimeBound(obj,"max")).toISOString();obj.format="strict_date_optional_time";delete obj[TIMEFILTER];delete obj.shift;delete obj.unit;return obj}_getTimeBound(opts,type){var _bounds$type;const bounds=this._timeCache.getTimeBounds();let result=((_bounds$type=bounds[type])===null||_bounds$type===void 0?void 0:_bounds$type.valueOf())||0;if(opts.shift){const shift=opts.shift;if(typeof shift!=="number"){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.shiftMustValueTypeErrorMessage",{defaultMessage:"{shiftParam} must be a numeric value",values:{shiftParam:'"shift"'}}))}let multiplier;switch(opts.unit||"d"){case"w":case"week":multiplier=1e3*60*60*24*7;break;case"d":case"day":multiplier=1e3*60*60*24;break;case"h":case"hour":multiplier=1e3*60*60;break;case"m":case"minute":multiplier=1e3*60;break;case"s":case"second":multiplier=1e3;break;default:throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.opensearchQueryParser.unknownUnitValueErrorMessage",{defaultMessage:"Unknown {unitParamName} value. Must be one of: [{unitParamValues}]",values:{unitParamName:'"unit"',unitParamValues:'"week", "day", "hour", "minute", "second"'}}))}result+=shift*multiplier}return result}static _roundInterval(interval){switch(true){case interval<=500:return"100ms";case interval<=5e3:return"1s";case interval<=7500:return"5s";case interval<=15e3:return"10s";case interval<=45e3:return"30s";case interval<=18e4:return"1m";case interval<=45e4:return"5m";case interval<=12e5:return"10m";case interval<=27e5:return"30m";case interval<=72e5:return"1h";case interval<=216e5:return"3h";case interval<=864e5:return"12h";case interval<=6048e5:return"24h";case interval<=18144e5:return"1w";case interval<36288e5:return"30d";default:return"1y"}}}var utils=__webpack_require__(62);var vega_base_view=__webpack_require__(65);function ems_file_parser_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class ems_file_parser_EmsFileParser{constructor(serviceSettings){ems_file_parser_defineProperty(this,"_serviceSettings",void 0);ems_file_parser_defineProperty(this,"_fileLayersP",void 0);this._serviceSettings=serviceSettings}parseUrl(obj,url){if(typeof url.name!=="string"){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.emsFileParser.missingNameOfFileErrorMessage",{defaultMessage:"{dataUrlParam} with {dataUrlParamValue} requires {nameParam} parameter (name of the file)",values:{dataUrlParam:'"data.url"',dataUrlParamValue:'{"%type%": "emsfile"}',nameParam:'"name"'}}))}if(!this._fileLayersP){this._fileLayersP=this._serviceSettings.getFileLayers()}return{obj:obj,name:url.name}}async populateData(requests){if(requests.length===0)return;const layers=await this._fileLayersP;for(const{obj:obj,name:name}of requests){const foundLayer=layers===null||layers===void 0?void 0:layers.find(v=>v.name===name);if(!foundLayer){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.emsFileParser.emsFileNameDoesNotExistErrorMessage",{defaultMessage:"{emsfile} {emsfileName} does not exist",values:{emsfileName:JSON.stringify(name),emsfile:"emsfile"}}))}const url=await this._serviceSettings.getUrlForRegionLayer(foundLayer);obj.url=Object(vega_base_view["b"])(url)}}}var external_osdSharedDeps_Jquery_=__webpack_require__(50);var external_osdSharedDeps_Jquery_default=__webpack_require__.n(external_osdSharedDeps_Jquery_);function url_parser_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class url_parser_UrlParser{constructor(onWarning){url_parser_defineProperty(this,"_onWarning",void 0);this._onWarning=onWarning}parseUrl(obj,urlObj){let url=urlObj.url;if(!url){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.urlParser.dataUrlRequiresUrlParameterInFormErrorMessage",{defaultMessage:'{dataUrlParam} requires a {urlParam} parameter in a form "{formLink}"',values:{dataUrlParam:'"data.url"',urlParam:'"url"',formLink:"https://example.org/path/subpath"}}))}const query=urlObj.query;if(!query){this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.urlParser.urlShouldHaveQuerySubObjectWarningMessage",{defaultMessage:"Using a {urlObject} should have a {subObjectName} sub-object",values:{urlObject:'"url": {"%type%": "url", "url": ...}',subObjectName:'"query"'}}))}else{url+=(url.includes("?")?"&":"?")+external_osdSharedDeps_Jquery_default.a.param(query)}obj.url=url}populateData(){}}var public_=__webpack_require__(7);function vega_parser_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const defaultColor=Object(external_osdSharedDeps_ElasticEui_["euiPaletteColorBlind"])()[0];const locToDirMap={left:"row-reverse",right:"row",top:"column-reverse",bottom:"column"};const DEFAULT_PARSER="opensearch";class vega_parser_VegaParser{constructor(spec,searchAPI,timeCache,filters,getServiceSettings){vega_parser_defineProperty(this,"spec",void 0);vega_parser_defineProperty(this,"hideWarnings",void 0);vega_parser_defineProperty(this,"error",void 0);vega_parser_defineProperty(this,"warnings",void 0);vega_parser_defineProperty(this,"_urlParsers",void 0);vega_parser_defineProperty(this,"isVegaLite",void 0);vega_parser_defineProperty(this,"useHover",void 0);vega_parser_defineProperty(this,"_config",void 0);vega_parser_defineProperty(this,"useMap",void 0);vega_parser_defineProperty(this,"renderer",void 0);vega_parser_defineProperty(this,"tooltips",void 0);vega_parser_defineProperty(this,"mapConfig",void 0);vega_parser_defineProperty(this,"vlspec",void 0);vega_parser_defineProperty(this,"useResize",void 0);vega_parser_defineProperty(this,"containerDir",void 0);vega_parser_defineProperty(this,"controlsDir",void 0);vega_parser_defineProperty(this,"searchAPI",void 0);vega_parser_defineProperty(this,"getServiceSettings",void 0);vega_parser_defineProperty(this,"filters",void 0);vega_parser_defineProperty(this,"timeCache",void 0);vega_parser_defineProperty(this,"visibleVisLayers",void 0);vega_parser_defineProperty(this,"visAugmenterConfig",void 0);this.spec=spec;this.hideWarnings=false;this.visibleVisLayers=new Map;this.visAugmenterConfig={};this.error=undefined;this.warnings=[];this.searchAPI=searchAPI;this.getServiceSettings=getServiceSettings;this.filters=filters;this.timeCache=timeCache}async parseAsync(){try{await this._parseAsync()}catch(err){this.error=utils["a"].formatErrorToStr(err)}return this}async _parseAsync(){if(this.isVegaLite!==undefined)throw new Error;if(typeof this.spec==="string"){const spec=hjson_default.a.parse(this.spec,{legacyRoot:false});if(!spec.$schema){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.inputSpecDoesNotSpecifySchemaErrorMessage",{defaultMessage:"Your specification requires a {schemaParam} field with a valid URL for\nVega (see {vegaSchemaUrl}) or\nVega-Lite (see {vegaLiteSchemaUrl}).\nThe URL is an identifier only. OpenSearch Dashboards and your browser will never access this URL.",values:{schemaParam:'"$schema"',vegaLiteSchemaUrl:"https://vega.github.io/vega-lite/docs/spec.html#top-level",vegaSchemaUrl:"https://vega.github.io/vega/docs/specification/#top-level-specification-properties"}}))}this.spec=spec}if(!external_osdSharedDeps_Lodash_default.a.isPlainObject(this.spec)){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.invalidVegaSpecErrorMessage",{defaultMessage:"Invalid Vega specification"}))}this.isVegaLite=this.parseSchema(this.spec).isVegaLite;this.useHover=!this.isVegaLite;this._config=this._parseConfig();this.hideWarnings=!!this._config.hideWarnings;this.visibleVisLayers=this._config.visibleVisLayers;this.visAugmenterConfig=this._config.visAugmenterConfig;this.useMap=this._config.type==="map";this.renderer=this._config.renderer==="svg"?"svg":"canvas";this.tooltips=this._parseTooltips();this._setDefaultColors();this._parseControlPlacement();if(this.useMap){this.mapConfig=this._parseMapConfig();this.useResize=false}else if(this.spec){this._compileWithAutosize()}await this._resolveDataUrls();if(this.isVegaLite){this._compileVegaLite()}}_compileWithAutosize(){var _this$visibleVisLayer;const defaultAutosize={type:"fit",contains:"padding"};const showPointInTimeEvents=((_this$visibleVisLayer=this.visibleVisLayers)===null||_this$visibleVisLayer===void 0?void 0:_this$visibleVisLayer.get(public_["VisLayerTypes"].PointInTimeEvents))===true;let autosize=this.spec.autosize;let useResize=true;if(!this.isVegaLite&&autosize&&typeof autosize==="object"&&"signal"in autosize){return}if(!autosize&&typeof autosize!=="undefined"){this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.autoSizeDoesNotAllowFalse",{defaultMessage:"{autoSizeParam} is enabled, it can only be disabled by setting {autoSizeParam} to {noneParam}",values:{autoSizeParam:'"autosize"',noneParam:'"none"'}}))}if(typeof autosize==="string"){useResize=autosize!=="none";autosize={...defaultAutosize,type:autosize}}else if(typeof autosize==="object"){var _autosize,_autosize2;autosize={...defaultAutosize,...autosize};useResize=Boolean(((_autosize=autosize)===null||_autosize===void 0?void 0:_autosize.type)&&((_autosize2=autosize)===null||_autosize2===void 0?void 0:_autosize2.type)!=="none")}else if(showPointInTimeEvents){autosize=undefined}else{autosize=defaultAutosize}if(useResize&&(this.spec.width&&this.spec.width!=="container"||this.spec.height&&this.spec.height!=="container")){this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.widthAndHeightParamsAreIgnored",{defaultMessage:"{widthParam} and {heightParam} params are ignored because {autoSizeParam} is enabled. Set {autoSizeParam}: {noneParam} to disable",values:{widthParam:'"width"',heightParam:'"height"',autoSizeParam:'"autosize"',noneParam:'"none"'}}))}if(useResize&&!showPointInTimeEvents){this.spec.width="container";this.spec.height="container"}this.spec.autosize=autosize;this.useResize=useResize}_compileVegaLite(){var _this$_config;this.vlspec=this.spec;const logger=vega["a"].logger(vega["a"].Warn);logger.warn=this._onWarning.bind(this);this.spec=vega["c"].compile(this.vlspec,logger).spec;if(this.useMap){if(!this.spec||!this.vlspec)return;const hasConfig=external_osdSharedDeps_Lodash_default.a.isPlainObject(this.vlspec.config);if(this.vlspec.config===undefined||hasConfig&&!this.vlspec.config.projection){if(!Array.isArray(this.spec.projections)||this.spec.projections.length!==1||this.spec.projections[0].name!=="projection"){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.VLCompilerShouldHaveGeneratedSingleProtectionObjectErrorMessage",{defaultMessage:"Internal error: Vega-Lite compiler should have generated a single projection object"}))}delete this.spec.projections}if(!this.vlspec.width)delete this.spec.width;if(!this.vlspec.height)delete this.spec.height;if(!this.vlspec.padding&&(this.vlspec.config===undefined||hasConfig&&!this.vlspec.config.padding)){delete this.spec.padding}if(!this.vlspec.autosize&&(this.vlspec.config===undefined||hasConfig&&!this.vlspec.config.autosize)){delete this.spec.autosize}}if((_this$_config=this._config)!==null&&_this$_config!==void 0&&_this$_config.signals){var _this$_config2;Object.entries((_this$_config2=this._config)===null||_this$_config2===void 0?void 0:_this$_config2.signals).forEach(_ref=>{let[markId,signals]=_ref;const mark=this.getMarkWithStyle(this.spec.marks,markId);if(mark){signals.forEach(signal=>{var _signal$on;(_signal$on=signal.on)===null||_signal$on===void 0?void 0:_signal$on.forEach(eventObj=>{eventObj.events="@".concat(mark.name,":").concat(eventObj.events)})});this.spec.signals=(this.spec.signals||[]).concat(signals)}})}}getMarkWithStyle(marks,style){if(!marks){return undefined}if(Array.isArray(marks)){const markWithStyle=marks.find(mark=>{var _mark$style;return(_mark$style=mark.style)===null||_mark$style===void 0?void 0:_mark$style.includes(style)});if(markWithStyle){return markWithStyle}for(let i=0;i<marks.length;i++){const res=this.getMarkWithStyle(marks[i].marks,style);if(res){return res}}return undefined}}_parseControlPlacement(){var _this$_config3,_this$_config4;this.containerDir=(_this$_config3=this._config)!==null&&_this$_config3!==void 0&&_this$_config3.controlsLocation?locToDirMap[this._config.controlsLocation]:undefined;if(this.containerDir===undefined){if(this._config&&this._config.controlsLocation===undefined){this.containerDir="column"}else{throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.unrecognizedControlsLocationValueErrorMessage",{defaultMessage:"Unrecognized {controlsLocationParam} value. Expecting one of [{locToDirMap}]",values:{locToDirMap:'"'.concat(Object.keys(locToDirMap).join('", "'),'"'),controlsLocationParam:"controlsLocation"}}))}}const dir=(_this$_config4=this._config)===null||_this$_config4===void 0?void 0:_this$_config4.controlsDirection;if(dir!==undefined&&dir!=="horizontal"&&dir!=="vertical"){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.unrecognizedDirValueErrorMessage",{defaultMessage:"Unrecognized {dirParam} value. Expecting one of [{expectedValues}]",values:{expectedValues:'"horizontal", "vertical"',dirParam:"dir"}}))}this.controlsDir=dir==="horizontal"?"row":"column"}_parseConfig(){let result=null;if(this.spec){if(this.spec._hostConfig!==undefined){result=this.spec._hostConfig;delete this.spec._hostConfig;if(!external_osdSharedDeps_Lodash_default.a.isPlainObject(result)){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.hostConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:'"_hostConfig"'}}))}this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.hostConfigIsDeprecatedWarningMessage",{defaultMessage:"{deprecatedConfigName} has been deprecated. Use {newConfigName} instead.",values:{deprecatedConfigName:'"_hostConfig"',newConfigName:"config.kibana"}}))}if(external_osdSharedDeps_Lodash_default.a.isPlainObject(this.spec.config)&&this.spec.config.kibana!==undefined){result=this.spec.config.kibana;delete this.spec.config.kibana;if(!external_osdSharedDeps_Lodash_default.a.isPlainObject(result)){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.opensearchDashboardsConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:"config.kibana"}}))}if(result.visibleVisLayers!==undefined&&Array.isArray(result.visibleVisLayers)){result.visibleVisLayers=new Map(result.visibleVisLayers)}}}return result||{}}_parseTooltips(){var _this$_config5;if(this._config&&this._config.tooltips===false){return false}const result=((_this$_config5=this._config)===null||_this$_config5===void 0?void 0:_this$_config5.tooltips)||{};if(result.position===undefined){result.position="top"}else if(["top","right","bottom","left"].indexOf(result.position)===-1){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.unexpectedValueForPositionConfigurationErrorMessage",{defaultMessage:"Unexpected value for the {configurationName} configuration",values:{configurationName:"result.position"}}))}if(result.padding===undefined){result.padding=16}else if(typeof result.padding!=="number"){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.paddingConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be a number",values:{configName:"config.kibana.result.padding"}}))}if(result.centerOnMark===undefined){result.centerOnMark=50}else if(typeof result.centerOnMark==="boolean"){result.centerOnMark=result.centerOnMark?Number.MAX_VALUE:-1}else if(typeof result.centerOnMark!=="number"){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.centerOnMarkConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be {trueValue}, {falseValue}, or a number",values:{configName:"config.kibana.result.centerOnMark",trueValue:"true",falseValue:"false"}}))}return result}_parseMapConfig(){var _this$_config6,_this$_config7,_this$_config8;const res={delayRepaint:((_this$_config6=this._config)===null||_this$_config6===void 0?void 0:_this$_config6.delayRepaint)===undefined?true:this._config.delayRepaint};const validate=(name,isZoom)=>{const val=this._config?this._config[name]:undefined;if(val!==undefined){const parsed=parseFloat(val);if(Number.isFinite(parsed)&&(!isZoom||parsed>=0&&parsed<=30)){res[name]=parsed;return}this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.someOpenSearchDashboardsurationIsNoValidWarningMessage",{defaultMessage:"{configName} is not valid",values:{configName:"config.kibana.".concat(name)}}))}if(!isZoom)res[name]=0};validate("latitude",false);validate("longitude",false);validate("zoom",true);validate("minZoom",true);validate("maxZoom",true);res.mapStyle=((_this$_config7=this._config)===null||_this$_config7===void 0?void 0:_this$_config7.mapStyle)===undefined?"default":this._config.mapStyle;if(res.mapStyle!=="default"&&res.mapStyle!==false){this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.mapStyleValueTypeWarningMessage",{defaultMessage:"{mapStyleConfigName} may either be {mapStyleConfigFirstAllowedValue} or {mapStyleConfigSecondAllowedValue}",values:{mapStyleConfigName:"config.kibana.mapStyle",mapStyleConfigFirstAllowedValue:"false",mapStyleConfigSecondAllowedValue:'"default"'}}));res.mapStyle="default"}this._parseBool("zoomControl",res,true);this._parseBool("scrollWheelZoom",res,false);const maxBounds=(_this$_config8=this._config)===null||_this$_config8===void 0?void 0:_this$_config8.maxBounds;if(maxBounds!==undefined){if(!Array.isArray(maxBounds)||maxBounds.length!==4||!maxBounds.every(v=>typeof v==="number"&&Number.isFinite(v))){this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.maxBoundsValueTypeWarningMessage",{defaultMessage:"{maxBoundsConfigName} must be an array with four numbers",values:{maxBoundsConfigName:"config.kibana.maxBounds"}}))}else{res.maxBounds=maxBounds}}return res}_parseBool(paramName,dstObj,dflt){const val=this._config?this._config[paramName]:undefined;if(val===undefined){dstObj[paramName]=dflt}else if(typeof val!=="boolean"){this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.someOpenSearchDashboardsParamValueTypeWarningMessage",{defaultMessage:"{configName} must be a boolean value",values:{configName:"config.kibana.".concat(paramName)}}));dstObj[paramName]=dflt}else{dstObj[paramName]=val}}parseSchema(spec){const schema=parser_default()(spec.$schema);const isVegaLite=schema.library==="vega-lite";const libVersion=isVegaLite?vega["c"].version:vega["a"].version;if(compare_versions_default()(schema.version,libVersion)>0){this._onWarning(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.notValidLibraryVersionForInputSpecWarningMessage",{defaultMessage:"The input spec uses {schemaLibrary} {schemaVersion}, but current version of {schemaLibrary} is {libraryVersion}.",values:{schemaLibrary:schema.library,schemaVersion:schema.version,libraryVersion:libVersion}}))}return{isVegaLite:isVegaLite,libVersion:libVersion}}async _resolveDataUrls(){if(!this._urlParsers){const serviceSettings=await this.getServiceSettings();const onWarn=this._onWarning.bind(this);this._urlParsers={opensearch:new opensearch_query_parser_OpenSearchQueryParser(this.timeCache,this.searchAPI,this.filters,onWarn),emsfile:new ems_file_parser_EmsFileParser(serviceSettings),url:new url_parser_UrlParser(onWarn)}}const pending={};this.searchAPI.resetSearchStats();this._findObjectDataUrls(this.spec,obj=>{const url=obj.url;delete obj.url;let type=url["%type%"];delete url["%type%"];if(type===undefined){type=DEFAULT_PARSER}const parser=this._urlParsers[type];if(parser===undefined){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.notSupportedUrlTypeErrorMessage",{defaultMessage:"{urlObject} is not supported",values:{urlObject:'url: {"%type%": "${type}"}'}}))}let pendingArr=pending[type];if(pendingArr===undefined){pending[type]=pendingArr=[]}pendingArr.push(parser.parseUrl(obj,url))});const pendingParsers=Object.keys(pending);if(pendingParsers.length>0){await Promise.all(pendingParsers.map(type=>this._urlParsers[type].populateData(pending[type])))}}_findObjectDataUrls(obj,onFind,key){if(Array.isArray(obj)){for(const elem of obj){this._findObjectDataUrls(elem,onFind,key)}}else if(external_osdSharedDeps_Lodash_default.a.isPlainObject(obj)){if(key==="data"&&external_osdSharedDeps_Lodash_default.a.isPlainObject(obj.url)){if(obj.values!==undefined||obj.source!==undefined){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.dataExceedsSomeParamsUseTimesLimitErrorMessage",{defaultMessage:"Data must not have more than one of {urlParam}, {valuesParam}, and {sourceParam}",values:{urlParam:'"url"',valuesParam:'"values"',sourceParam:'"source"'}}))}onFind(obj)}else{for(const k of Object.keys(obj)){this._findObjectDataUrls(obj[k],onFind,k)}}}}_setDefaultColors(){this._setDefaultValue(Object(external_osdSharedDeps_ElasticEui_["euiPaletteColorBlind"])(),"config","range","category");if(this.isVegaLite){this._setDefaultValue(defaultColor,"config","mark","color");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiTextColor,"config","text","fill")}else{var _this$spec;if(!((_this$spec=this.spec)!==null&&_this$spec!==void 0&&_this$spec.config.mark)||this.spec.config.mark.color===undefined&&this.spec.config.mark.fill===undefined){this._setDefaultValue(defaultColor,"config","arc","fill");this._setDefaultValue(defaultColor,"config","area","fill");this._setDefaultValue(defaultColor,"config","line","stroke");this._setDefaultValue(defaultColor,"config","path","stroke");this._setDefaultValue(defaultColor,"config","rect","fill");this._setDefaultValue(defaultColor,"config","rule","stroke");this._setDefaultValue(defaultColor,"config","shape","stroke");this._setDefaultValue(defaultColor,"config","symbol","fill");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiTextColor,"config","text","fill");this._setDefaultValue(defaultColor,"config","trail","fill")}}this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiColorDarkestShade,"config","title","color");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiColorDarkShade,"config","style","guide-label","fill");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiColorDarkestShade,"config","style","guide-title","fill");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiColorDarkestShade,"config","style","group-title","fill");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiColorDarkestShade,"config","style","group-subtitle","fill");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiColorChartLines,"config","axis","tickColor");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiColorChartLines,"config","axis","domainColor");this._setDefaultValue(external_osdSharedDeps_Theme_["euiThemeVars"].euiColorChartLines,"config","axis","gridColor");this._setDefaultValue("transparent","config","background")}_setDefaultValue(value){var _ref2;let o=this.spec;for(let i=0;i<(arguments.length<=1?0:arguments.length-1)-1;i++){const field=i+1<1||arguments.length<=i+1?undefined:arguments[i+1];const subObj=o[field];if(subObj===undefined){o[field]={}}else if(!external_osdSharedDeps_Lodash_default.a.isPlainObject(subObj)){return}o=o[field]}const lastField=(_ref2=(arguments.length<=1?0:arguments.length-1)-1+1,_ref2<1||arguments.length<=_ref2?undefined:arguments[_ref2]);if(o[lastField]===undefined){o[lastField]=value}}_onWarning(){if(!this.hideWarnings){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this.warnings.push(utils["a"].formatWarningToStr(args));return utils["a"].formatWarningToStr(args)}}}},55:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return vegaLite}));var vega_lite_next_src__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(74);var vega_build_es5_vega__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(60);var vega_build_es5_vega__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(vega_build_es5_vega__WEBPACK_IMPORTED_MODULE_1__);__webpack_require__.d(__webpack_exports__,"a",(function(){return vega_build_es5_vega__WEBPACK_IMPORTED_MODULE_1__}));var vega_interpreter_build_vega_interpreter_module__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61);__webpack_require__.d(__webpack_exports__,"b",(function(){return vega_interpreter_build_vega_interpreter_module__WEBPACK_IMPORTED_MODULE_2__["a"]}));const vegaLite={compile:vega_lite_next_src__WEBPACK_IMPORTED_MODULE_0__["a"],version:vega_lite_next_src__WEBPACK_IMPORTED_MODULE_0__["b"]}},62:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return utils_Utils}));var json_stringify_pretty_compact=__webpack_require__(18);var json_stringify_pretty_compact_default=__webpack_require__.n(json_stringify_pretty_compact);const validate_object_hasOwnProperty=(obj,property)=>Object.prototype.hasOwnProperty.call(obj,property);const isObject=obj=>typeof obj==="object"&&obj!==null;function validateObject(obj){if(!isObject(obj)){return}const stack=[{value:obj,previousKey:null}];const seen=new WeakSet([obj]);while(stack.length>0){const{value:value,previousKey:previousKey}=stack.pop();if(!isObject(value)){continue}if(validate_object_hasOwnProperty(value,"__proto__")){throw new Error("'__proto__' is an invalid key")}if(validate_object_hasOwnProperty(value,"prototype")&&previousKey==="constructor"){throw new Error("'constructor.prototype' is an invalid key")}const entries=Object.entries(value);for(let i=entries.length-1;i>=0;--i){const[key,childValue]=entries[i];if(isObject(childValue)){if(seen.has(childValue)){throw new Error("circular reference detected")}seen.add(childValue)}stack.push({value:childValue,previousKey:key})}}}class utils_Utils{static formatWarningToStr(){let value=arguments.length<=0?undefined:arguments[0];if(arguments.length>=2){try{if(typeof(arguments.length<=1?undefined:arguments[1])==="string"){value+="\n".concat(arguments.length<=1?undefined:arguments[1])}else{value+="\n"+json_stringify_pretty_compact_default()(arguments.length<=1?undefined:arguments[1],{maxLength:70})}}catch(err){}}return value}static formatErrorToStr(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}let error=args[0];if(!error){error="ERR"}else if(error instanceof Error){error=error.message}return utils_Utils.formatWarningToStr(error,...Array.from(args).slice(1))}static handleNonStringIndex(index){return typeof index==="string"?index:undefined}static handleInvalidQuery(query){if(utils_Utils.isObject(query)&&!utils_Utils.checkForFunctionProperty(query)){validateObject(query);return JSON.parse(JSON.stringify(query))}return null}static isObject(object){return!!(object&&typeof object==="object"&&!Array.isArray(object))}static checkForFunctionProperty(object){let result=false;Object.values(object).forEach(value=>{result=typeof value==="function"?true:utils_Utils.isObject(value)&&utils_Utils.checkForFunctionProperty(value)});return result}static handleInvalidDate(date){if(typeof date==="number"){return!isNaN(date)?date:null}else if(date instanceof Date||typeof date==="string"){return date}return null}}},65:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return bypassExternalUrlCheck}));__webpack_require__.d(__webpack_exports__,"a",(function(){return vega_base_view_VegaBaseView}));var external_osdSharedDeps_Jquery_=__webpack_require__(50);var external_osdSharedDeps_Jquery_default=__webpack_require__.n(external_osdSharedDeps_Jquery_);var external_osdSharedDeps_Moment_=__webpack_require__(49);var external_osdSharedDeps_Moment_default=__webpack_require__.n(external_osdSharedDeps_Moment_);var target=__webpack_require__(72);var target_default=__webpack_require__.n(target);var vega=__webpack_require__(55);var utils=__webpack_require__(62);var external_osdSharedDeps_ElasticEui_=__webpack_require__(1);var external_osdSharedDeps_OsdI18n_=__webpack_require__(2);var vega_tooltip=__webpack_require__(73);var external_osdSharedDeps_Lodash_=__webpack_require__(6);var external_osdSharedDeps_Lodash_default=__webpack_require__.n(external_osdSharedDeps_Lodash_);const tooltipId="vega-opensearch-dashboards-tooltip";function createRect(left,top,width,height){return{left:left,top:top,width:width,height:height,x:left,y:top,right:left+width,bottom:top+height}}class vega_tooltip_TooltipHandler{constructor(container,view,opts){this.container=container;this.position=opts.position;this.padding=opts.padding;this.centerOnMark=opts.centerOnMark;view.tooltip(this.handler.bind(this))}handler(view,event,item,value){this.hideTooltip();if(value==null||value===""){return}const el=document.createElement("div");el.setAttribute("id",tooltipId);["vgaVis__tooltip","euiToolTipPopover","euiToolTip","euiToolTip--".concat(this.position)].forEach(className=>{el.classList.add(className)});el.innerHTML=Object(vega_tooltip["formatValue"])(value,external_osdSharedDeps_Lodash_default.a.escape,2);document.body.appendChild(el);let anchorBounds;if(item.bounds.width()>this.centerOnMark||item.bounds.height()>this.centerOnMark){anchorBounds=createRect(event.clientX,event.clientY,0,0)}else{const containerBox=this.container.getBoundingClientRect();anchorBounds=createRect(containerBox.left+view._origin[0]+item.bounds.x1,containerBox.top+view._origin[1]+item.bounds.y1,item.bounds.width(),item.bounds.height())}const pos=Object(external_osdSharedDeps_ElasticEui_["calculatePopoverPosition"])(anchorBounds,el.getBoundingClientRect(),this.position,this.padding);el.setAttribute("style","top: ".concat(pos.top,"px; left: ").concat(pos.left,"px"))}hideTooltip(){const el=document.getElementById(tooltipId);if(el)el.remove()}}var public_=__webpack_require__(11);var services=__webpack_require__(3);var extract_index_pattern=__webpack_require__(19);vega["a"].scheme("euiPaletteColorBlind",Object(external_osdSharedDeps_ElasticEui_["euiPaletteColorBlind"])());const vegaFunctions={opensearchDashboardsAddFilter:"addFilterHandler",opensearchDashboardsRemoveFilter:"removeFilterHandler",opensearchDashboardsRemoveAllFilters:"removeAllFiltersHandler",opensearchDashboardsSetTimeFilter:"setTimeFilterHandler",opensearchDashboardsVisEventTriggered:"triggerExternalActionHandler"};for(const funcName of Object.keys(vegaFunctions)){if(!vega["a"].expressionFunction(funcName)){vega["a"].expressionFunction(funcName,(function handlerFwd(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}const view=this.context.dataflow;view.runAfter(()=>view._opensearchDashboardsView.vegaFunctionsHandler(funcName,...args))}))}}const bypassToken=Symbol();function bypassExternalUrlCheck(url){return{url:url,bypassToken:bypassToken}}class vega_base_view_VegaBaseView{constructor(opts){this._$parentEl=external_osdSharedDeps_Jquery_default()(opts.parentEl);this._parser=opts.vegaParser;this._serviceSettings=opts.serviceSettings;this._filterManager=opts.filterManager;this._applyFilter=opts.applyFilter;this._triggerExternalAction=opts.externalAction;this._timefilter=opts.timefilter;this._view=null;this._vegaViewConfig=null;this._vegaViewOptions=null;this._$messages=null;this._destroyHandlers=[];this._initialized=false;this._enableExternalUrls=Object(services["c"])()}async init(){if(this._initialized)throw new Error;this._initialized=true;try{this._$parentEl.empty().addClass("vgaVis").css("flex-direction",this._parser.containerDir);for(const warn of this._parser.warnings){this._addMessage("warn",warn)}if(this._parser.error){this._addMessage("err",this._parser.error);return}this._$container=external_osdSharedDeps_Jquery_default()('<div class="vgaVis__view">').css("height","100%").appendTo(this._$parentEl);this._$controls=external_osdSharedDeps_Jquery_default()('<div class="vgaVis__controls vgaVis__controls--'.concat(this._parser.controlsDir,'">')).appendTo(this._$parentEl);this._addDestroyHandler(()=>{if(this._$container){this._$container.remove();this._$container=null}if(this._$controls){this._$controls.remove();this._$controls=null}if(this._$messages){this._$messages.remove();this._$messages=null}if(this._view){this._view.finalize()}this._view=null});this._vegaViewConfig=this.createViewConfig();this._vegaViewOptions={ast:true};await this._initViewCustomizations()}catch(err){this.onError(err)}}async findIndex(index){const{indexPatterns:indexPatterns}=Object(services["a"])();let idxObj;if(index){[idxObj]=await indexPatterns.find(index);if(!idxObj){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.baseView.indexNotFoundErrorMessage",{defaultMessage:"Index {index} not found",values:{index:'"'.concat(index,'"')}}))}}else{[idxObj]=await Object(extract_index_pattern["a"])(this._parser.isVegaLite?this._parser.vlspec:this._parser.spec);if(!idxObj){const defaultIdx=await indexPatterns.getDefault();if(defaultIdx){idxObj=defaultIdx}else{throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.baseView.unableToFindDefaultIndexErrorMessage",{defaultMessage:"Unable to find default index"}))}}}return idxObj.id}createViewConfig(){const config={logLevel:vega["a"].Warn,renderer:this._parser.renderer,expr:vega["b"]};const loader=vega["a"].loader();const originalSanitize=loader.sanitize.bind(loader);loader.sanitize=(uri,options)=>{if(uri.bypassToken===bypassToken){uri=uri.url}else if(!this._enableExternalUrls){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.baseView.externalUrlsAreNotEnabledErrorMessage",{defaultMessage:"External URLs are not enabled. Add   {enableExternalUrls}   to {opensearchDashboardsConfigFileName}",values:{enableExternalUrls:"vis_type_vega.enableExternalUrls: true",opensearchDashboardsConfigFileName:"opensearch_dashboards.yml"}}))}return originalSanitize(uri,options)};config.loader=loader;return config}onError(){this._addMessage("err",utils["a"].formatErrorToStr(...arguments))}onWarn(){if(!this._parser||!this._parser.hideWarnings){this._addMessage("warn",utils["a"].formatWarningToStr(...arguments))}}_addMessage(type,text){if(!this._$messages){this._$messages=external_osdSharedDeps_Jquery_default()('<ul class="vgaVis__messages">').appendTo(this._$parentEl)}this._$messages.append(external_osdSharedDeps_Jquery_default()('<li class="vgaVis__message vgaVis__message--'.concat(type,'">')).append(external_osdSharedDeps_Jquery_default()('<pre class="vgaVis__messageCode">').text(text)))}resize(){if(this._parser.useResize&&this._view&&this.updateVegaSize(this._view)){return this._view.runAsync()}}updateVegaSize(view){const heightExtraPadding=6;const width=Math.max(0,this._$container.width());const height=Math.max(0,this._$container.height())-heightExtraPadding;if(view.width()!==width||view.height()!==height){view.width(width).height(height);return true}return false}addPointInTimeEventPadding(view){const eventVisHeight=100;const height=Math.max(0,this._$container.height())-eventVisHeight;if(view._signals.concat_0_height!==undefined){view._signals.concat_0_height.value=height}}setView(view){if(this._view===view)return;if(this._view){this._view.finalize()}this._view=view;if(view){view._opensearchDashboardsView=this;if(this._parser.tooltips){const tthandler=new vega_tooltip_TooltipHandler(this._$container[0],view,this._parser.tooltips);this._addDestroyHandler(()=>tthandler.hideTooltip())}return view.runAsync()}}async vegaFunctionsHandler(funcName){try{const handlerFunc=vegaFunctions[funcName];if(!handlerFunc||!this[handlerFunc]){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.baseView.functionIsNotDefinedForGraphErrorMessage",{defaultMessage:"{funcName} is not defined for this graph",values:{funcName:"".concat(funcName,"()")}}))}for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}await this[handlerFunc](...args)}catch(err){this.onError(err)}}async addFilterHandler(query,index,alias){const indexId=await this.findIndex(utils["a"].handleNonStringIndex(index));const filter=public_["opensearchFilters"].buildQueryFilter(utils["a"].handleInvalidQuery(query),indexId,alias);this._applyFilter({filters:[filter]})}triggerExternalActionHandler(event,datum){this._triggerExternalAction({event:event,item:datum})}async removeFilterHandler(query,index){const indexId=await this.findIndex(utils["a"].handleNonStringIndex(index));const filterToRemove=public_["opensearchFilters"].buildQueryFilter(utils["a"].handleInvalidQuery(query),indexId);const currentFilters=this._filterManager.getFilters();const existingFilter=currentFilters.find(filter=>public_["opensearchFilters"].compareFilters(filter,filterToRemove));if(!existingFilter)return;try{this._filterManager.removeFilter(existingFilter)}catch(err){this.onError(err)}}removeAllFiltersHandler(){this._filterManager.removeAll()}setTimeFilterHandler(start,end){const{from:from,to:to,mode:mode}=vega_base_view_VegaBaseView._parseTimeRange(utils["a"].handleInvalidDate(start),utils["a"].handleInvalidDate(end));this._applyFilter({timeFieldName:"*",filters:[{range:{"*":{mode:mode,gte:from,lte:to}}}]})}static _parseTimeRange(start,end){const absStart=external_osdSharedDeps_Moment_default()(start);const absEnd=external_osdSharedDeps_Moment_default()(end);const isValidAbsStart=absStart.isValid();const isValidAbsEnd=absEnd.isValid();let mode="absolute";let from;let to;let reverse;if(isValidAbsStart&&isValidAbsEnd){from=absStart;to=absEnd;reverse=absStart.isAfter(absEnd)}else{const startDate=target_default.a.parse(start);const endDate=target_default.a.parse(end);if(!startDate||!endDate||!startDate.isValid()||!endDate.isValid()){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("visTypeVega.vegaParser.baseView.timeValuesTypeErrorMessage",{defaultMessage:"Error setting time filter: both time values must be either relative or absolute dates. {start}, {end}",values:{start:"start=".concat(JSON.stringify(start)),end:"end=".concat(JSON.stringify(end))}}))}reverse=startDate.isAfter(endDate);if(isValidAbsStart||isValidAbsEnd){from=startDate;to=endDate}else{mode="relative";from=start;to=end}}if(reverse){[from,to]=[to,from]}return{from:from,to:to,mode:mode}}setDebugValues(view,spec,vlspec){var _this$_parser$searchA,_this$_parser$searchA2;(_this$_parser$searchA=this._parser.searchAPI.inspectorAdapters)===null||_this$_parser$searchA===void 0?void 0:(_this$_parser$searchA2=_this$_parser$searchA.vega)===null||_this$_parser$searchA2===void 0?void 0:_this$_parser$searchA2.bindInspectValues({view:view,spec:vlspec||spec});if(window){if(window.VEGA_DEBUG===undefined&&console){console.log("%cWelcome to OpenSearch Dashboards Vega Plugin!","font-size: 16px; font-weight: bold;");console.log("You can access the Vega view with VEGA_DEBUG. "+"Learn more at https://vega.github.io/vega/docs/api/debugging/.")}const debugObj={};window.VEGA_DEBUG=debugObj;window.VEGA_DEBUG.VEGA_VERSION=vega["a"].version;window.VEGA_DEBUG.VEGA_LITE_VERSION=vega["c"].version;window.VEGA_DEBUG.view=view;window.VEGA_DEBUG.vega_spec=spec;window.VEGA_DEBUG.vegalite_spec=vlspec;this._addDestroyHandler(()=>{if(debugObj===window.VEGA_DEBUG){window.VEGA_DEBUG=null}})}}destroy(){if(this._destroyHandlers){this._ongoingDestroy=Promise.all(this._destroyHandlers.map(v=>v()));this._destroyHandlers=null}return this._ongoingDestroy}_addDestroyHandler(handler){if(this._destroyHandlers){this._destroyHandlers.push(handler)}else{handler()}}}},79:function(module,exports){module.exports=function(e){const[n,o]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:n,version:o}}},80:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(root,factory){if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{}})(this,(function(){var semver=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function indexOrEnd(str,q){return str.indexOf(q)===-1?str.length:str.indexOf(q)}function split(v){var c=v.replace(/^v/,"").replace(/\+.*$/,"");var patchIndex=indexOrEnd(c,"-");var arr=c.substring(0,patchIndex).split(".");arr.push(c.substring(patchIndex+1));return arr}function tryParse(v){return isNaN(Number(v))?v:Number(v)}function validate(version){if(typeof version!=="string"){throw new TypeError("Invalid argument expected string")}if(!semver.test(version)){throw new Error("Invalid argument not valid semver ('"+version+"' received)")}}function compareVersions(v1,v2){[v1,v2].forEach(validate);var s1=split(v1);var s2=split(v2);for(var i=0;i<Math.max(s1.length-1,s2.length-1);i++){var n1=parseInt(s1[i]||0,10);var n2=parseInt(s2[i]||0,10);if(n1>n2)return 1;if(n2>n1)return-1}var sp1=s1[s1.length-1];var sp2=s2[s2.length-1];if(sp1&&sp2){var p1=sp1.split(".").map(tryParse);var p2=sp2.split(".").map(tryParse);for(i=0;i<Math.max(p1.length,p2.length);i++){if(p1[i]===undefined||typeof p2[i]==="string"&&typeof p1[i]==="number")return-1;if(p2[i]===undefined||typeof p1[i]==="string"&&typeof p2[i]==="number")return 1;if(p1[i]>p2[i])return 1;if(p2[i]>p1[i])return-1}}else if(sp1||sp2){return sp1?-1:1}return 0}var allowedOperators=[">",">=","=","<","<="];var operatorResMap={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function validateOperator(op){if(typeof op!=="string"){throw new TypeError("Invalid operator type, expected string but got "+typeof op)}if(allowedOperators.indexOf(op)===-1){throw new TypeError("Invalid operator, expected one of "+allowedOperators.join("|"))}}compareVersions.compare=function(v1,v2,operator){validateOperator(operator);var res=compareVersions(v1,v2);return operatorResMap[operator].indexOf(res)>-1};return compareVersions}))}}]);