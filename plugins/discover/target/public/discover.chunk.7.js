(window["discover_bundle_jsonpfunction"]=window["discover_bundle_jsonpfunction"]||[]).push([[7],{174:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"renderDocView",(function(){return renderDocView}));var public_=__webpack_require__(23);var external_osdSharedDeps_React_=__webpack_require__(0);var external_osdSharedDeps_React_default=__webpack_require__.n(external_osdSharedDeps_React_);var external_osdSharedDeps_ReactRouterDom_=__webpack_require__(10);var opensearch_dashboards_services=__webpack_require__(5);var external_osdSharedDeps_OsdI18n_=__webpack_require__(1);var breadcrumbs=__webpack_require__(74);var external_osdSharedDeps_OsdI18nReact_=__webpack_require__(6);var external_osdSharedDeps_ElasticEui_=__webpack_require__(2);let OpenSearchRequestState;(function(OpenSearchRequestState){OpenSearchRequestState[OpenSearchRequestState["Loading"]=0]="Loading";OpenSearchRequestState[OpenSearchRequestState["NotFound"]=1]="NotFound";OpenSearchRequestState[OpenSearchRequestState["Found"]=2]="Found";OpenSearchRequestState[OpenSearchRequestState["Error"]=3]="Error";OpenSearchRequestState[OpenSearchRequestState["NotFoundIndexPattern"]=4]="NotFoundIndexPattern"})(OpenSearchRequestState||(OpenSearchRequestState={}));function buildSearchBody(id,indexPattern){const computedFields=indexPattern.getComputedFields();return{query:{ids:{values:[id]}},stored_fields:computedFields.storedFields,_source:true,script_fields:computedFields.scriptFields,docvalue_fields:computedFields.docvalueFields}}function useOpenSearchDocSearch(_ref){let{id:id,index:index,indexPatternId:indexPatternId,indexPatternService:indexPatternService}=_ref;const[indexPattern,setIndexPattern]=Object(external_osdSharedDeps_React_["useState"])(null);const[status,setStatus]=Object(external_osdSharedDeps_React_["useState"])(OpenSearchRequestState.Loading);const[hit,setHit]=Object(external_osdSharedDeps_React_["useState"])(null);Object(external_osdSharedDeps_React_["useEffect"])(()=>{async function requestData(){try{var _indexPatternEntity$d,_hits$hits;const indexPatternEntity=await indexPatternService.get(indexPatternId);setIndexPattern(indexPatternEntity);const{rawResponse:rawResponse}=await Object(opensearch_dashboards_services["f"])().data.search.search({dataSourceId:(_indexPatternEntity$d=indexPatternEntity.dataSourceRef)===null||_indexPatternEntity$d===void 0?void 0:_indexPatternEntity$d.id,params:{index:index,body:buildSearchBody(id,indexPatternEntity)}}).toPromise();const hits=rawResponse.hits;if(hits!==null&&hits!==void 0&&(_hits$hits=hits.hits)!==null&&_hits$hits!==void 0&&_hits$hits[0]){setStatus(OpenSearchRequestState.Found);setHit(hits.hits[0])}else{setStatus(OpenSearchRequestState.NotFound)}}catch(err){if(err.savedObjectId){setStatus(OpenSearchRequestState.NotFoundIndexPattern)}else if(err.status===404){setStatus(OpenSearchRequestState.NotFound)}else{setStatus(OpenSearchRequestState.Error)}}}requestData()},[id,index,indexPatternId,indexPatternService]);return[status,hit,indexPattern]}var doc_viewer=__webpack_require__(82);function Doc(props){const[reqState,hit,indexPattern]=useOpenSearchDocSearch(props);return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["I18nProvider"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPageContent"],null,reqState===OpenSearchRequestState.NotFoundIndexPattern&&external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCallOut"],{color:"danger","data-test-subj":"doc-msg-notFoundIndexPattern",iconType:"alert",title:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.doc.failedToLocateIndexPattern",defaultMessage:"No index pattern matches ID {indexPatternId}",values:{indexPatternId:props.indexPatternId}})}),reqState===OpenSearchRequestState.NotFound&&external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCallOut"],{color:"danger","data-test-subj":"doc-msg-notFound",iconType:"alert",title:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.doc.failedToLocateDocumentDescription",defaultMessage:"Cannot find document"})},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.doc.couldNotFindDocumentsDescription",defaultMessage:"No documents match that ID."})),reqState===OpenSearchRequestState.Error&&external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCallOut"],{color:"danger","data-test-subj":"doc-msg-error",iconType:"alert",title:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.doc.failedToExecuteQueryDescription",defaultMessage:"Cannot run search"})},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.doc.somethingWentWrongDescription",defaultMessage:"{indexName} is missing.",values:{indexName:props.index}})," ",external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiLink"],{href:"https://opensearch.org/docs/latest/opensearch/rest-api/index-apis/exists/",target:"_blank"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.doc.somethingWentWrongDescriptionAddon",defaultMessage:"Please ensure the index exists."}))),reqState===OpenSearchRequestState.Loading&&external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCallOut"],{"data-test-subj":"doc-msg-loading"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"m"})," ",external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.doc.loadingDescription",defaultMessage:"Loadingâ€¦"})),reqState===OpenSearchRequestState.Found&&hit!==null&&indexPattern&&external_osdSharedDeps_React_default.a.createElement("div",{"data-test-subj":"doc-hit"},external_osdSharedDeps_React_default.a.createElement(doc_viewer["a"],{hit:hit,indexPattern:indexPattern}))))}function useQueryString(){return new URLSearchParams(Object(external_osdSharedDeps_ReactRouterDom_["useLocation"])().search)}function SingleDocApp(){const{services:{chrome:chrome,timefilter:timefilter,indexPatterns:indexPatterns}}=Object(public_["useOpenSearchDashboards"])();const{index:index,indexPatternId:indexPatternId}=Object(external_osdSharedDeps_ReactRouterDom_["useParams"])();const[indexPattern,setIndexPattern]=Object(external_osdSharedDeps_React_["useState"])(undefined);const[error,setError]=Object(external_osdSharedDeps_React_["useState"])(null);const query=useQueryString();const docId=query.get("id")||"";Object(external_osdSharedDeps_React_["useEffect"])(()=>{async function getIndexPatternById(){try{const ip=await indexPatterns.get(indexPatternId);setIndexPattern(ip)}catch(e){setError(e)}}getIndexPatternById()},[indexPatternId,indexPatterns]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{chrome.setBreadcrumbs([...Object(breadcrumbs["a"])(),{text:external_osdSharedDeps_OsdI18n_["i18n"].translate("discover.single.breadcrumb",{defaultMessage:"{index}#{docId}",values:{index:index,docId:docId}})}])},[chrome,index,docId]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{timefilter.disableAutoRefreshSelector();timefilter.disableTimeRangeSelector()});if(error){return external_osdSharedDeps_React_default.a.createElement("div",null,"Error fetching index pattern: ",error.message)}if(!indexPattern){return external_osdSharedDeps_React_default.a.createElement("div",null,"Index pattern loading")}return external_osdSharedDeps_React_default.a.createElement("div",{className:"single doc view"},external_osdSharedDeps_React_default.a.createElement(Doc,{id:docId,index:index,indexPatternId:indexPatternId,indexPatternService:indexPatterns}))}var external_osdSharedDeps_Lodash_=__webpack_require__(12);var external_osdSharedDeps_Lodash_default=__webpack_require__.n(external_osdSharedDeps_Lodash_);var data_public_=__webpack_require__(4);var opensearchDashboardsUtils_public_=__webpack_require__(3);const GLOBAL_STATE_URL_KEY="_g";const APP_STATE_URL_KEY="_a";function getState(_ref){let{defaultStepSize:defaultStepSize,timeFieldName:timeFieldName,storeInSessionStorage:storeInSessionStorage=false,history:history,toasts:toasts}=_ref;const stateStorage=Object(opensearchDashboardsUtils_public_["createOsdUrlStateStorage"])({useHash:storeInSessionStorage,history:history,...toasts&&Object(opensearchDashboardsUtils_public_["withNotifyOnErrors"])(toasts)});const globalStateInitial=stateStorage.get(GLOBAL_STATE_URL_KEY);const globalStateContainer=Object(opensearchDashboardsUtils_public_["createStateContainer"])(globalStateInitial);const appStateFromUrl=stateStorage.get(APP_STATE_URL_KEY);const appStateInitial=createInitialAppState(defaultStepSize,timeFieldName,appStateFromUrl);const appStateContainer=Object(opensearchDashboardsUtils_public_["createStateContainer"])(appStateInitial);const{start:start,stop:stop}=Object(opensearchDashboardsUtils_public_["syncStates"])([{storageKey:GLOBAL_STATE_URL_KEY,stateContainer:{...globalStateContainer,...{set:value=>{if(value){globalStateContainer.set(value)}}}},stateStorage:stateStorage},{storageKey:APP_STATE_URL_KEY,stateContainer:{...appStateContainer,...{set:value=>{if(value){appStateContainer.set(value)}}}},stateStorage:stateStorage}]);return{globalState:globalStateContainer,appState:appStateContainer,startSync:start,stopSync:stop,setAppState:newState=>{const oldState=appStateContainer.getState();const mergedState={...oldState,...newState};if(!isEqualState(oldState,mergedState)){appStateContainer.set(mergedState)}},getFilters:()=>[...context_state_getFilters(globalStateContainer.getState()),...context_state_getFilters(appStateContainer.getState())],setFilters:filterManager=>{const globalFilters=filterManager.getGlobalFilters();const globalFilterChanged=!isEqualFilters(globalFilters,context_state_getFilters(globalStateContainer.getState()));if(globalFilterChanged){globalStateContainer.set({filters:globalFilters})}const appFilters=filterManager.getAppFilters();const appFilterChanged=!isEqualFilters(appFilters,context_state_getFilters(appStateContainer.getState()));if(appFilterChanged){appStateContainer.set({...appStateContainer.getState(),...{filters:appFilters}})}},flushToUrl:replace=>stateStorage.flush({replace:replace})}}function isEqualFilters(filtersA,filtersB){if(!filtersA&&!filtersB){return true}else if(!filtersA||!filtersB){return false}return data_public_["opensearchFilters"].compareFilters(filtersA,filtersB,data_public_["opensearchFilters"].COMPARE_ALL_OPTIONS)}function isEqualState(stateA,stateB){if(!stateA&&!stateB){return true}else if(!stateA||!stateB){return false}const{filters:stateAFilters=[],...stateAPartial}=stateA;const{filters:stateBFilters=[],...stateBPartial}=stateB;return external_osdSharedDeps_Lodash_default.a.isEqual(stateAPartial,stateBPartial)&&data_public_["opensearchFilters"].compareFilters(stateAFilters,stateBFilters,data_public_["opensearchFilters"].COMPARE_ALL_OPTIONS)}function context_state_getFilters(state){if(!state||!Array.isArray(state.filters)){return[]}return state.filters}function createInitialAppState(defaultSize,timeFieldName,urlState){const defaultState={columns:["_source"],filters:[],predecessorCount:parseInt(defaultSize,10),sort:[timeFieldName,"desc"],successorCount:parseInt(defaultSize,10)};if(typeof urlState!=="object"){return defaultState}return{...defaultState,...urlState}}var common=__webpack_require__(8);const useContextState=_ref=>{let{services:services,indexPattern:indexPattern}=_ref;const{uiSettings:uiSettings,history:history,core:core,filterManager:filterManager}=services;const{appState:appStateContainer,setAppState:setAppStateContainer,startSync:startSync,stopSync:stopSync,getFilters:getFilters,setFilters:setFilters,flushToUrl:flushToUrl}=Object(external_osdSharedDeps_React_["useMemo"])(()=>getState({defaultStepSize:uiSettings.get(common["a"]),timeFieldName:indexPattern.timeFieldName,storeInSessionStorage:uiSettings.get("state:storeInSessionStorage"),history:history(),toasts:core.notifications.toasts}),[uiSettings,history,core.notifications.toasts,indexPattern.timeFieldName]);const[contextAppState,setContextState]=Object(external_osdSharedDeps_React_["useState"])(appStateContainer.getState());Object(external_osdSharedDeps_React_["useEffect"])(()=>{filterManager.setFilters(Object(external_osdSharedDeps_Lodash_["cloneDeep"])(getFilters()));startSync();const unsubscribeFromAppStateChanges=appStateContainer.subscribe(newState=>{setContextState(currentState=>({...currentState,...newState}))});const filterObservable=filterManager.getUpdates$().subscribe(()=>{setFilters(filterManager)});return()=>{stopSync();unsubscribeFromAppStateChanges();filterObservable.unsubscribe()}},[filterManager,getFilters,setFilters,startSync,stopSync,appStateContainer]);const setContextAppState=newValues=>{for(const[key,value]of Object.entries(newValues)){setAppStateContainer({[key]:value});flushToUrl(true)}};return{contextAppState:contextAppState,setContextAppState:setContextAppState}};async function fetchAnchor(anchorId,indexPattern,searchSource,sort){var _response$hits,_response$hits$hits;updateSearchSource(searchSource,anchorId,sort,indexPattern);const response=await searchSource.fetch();const doc=(_response$hits=response.hits)===null||_response$hits===void 0?void 0:(_response$hits$hits=_response$hits.hits)===null||_response$hits$hits===void 0?void 0:_response$hits$hits[0];if(!doc){throw new Error(external_osdSharedDeps_OsdI18n_["i18n"].translate("discover.context.failedToLoadAnchorDocumentErrorDescription",{defaultMessage:"Failed to load anchor document."}))}return{...doc,isAnchor:true}}function updateSearchSource(searchSource,anchorId,sort,indexPattern){searchSource.setParent(undefined).setField("index",indexPattern).setField("version",true).setField("size",1).setField("query",{query:{constant_score:{filter:{ids:{values:[anchorId]}}}},language:"lucene"}).setField("sort",sort);return searchSource}let SortDirection;(function(SortDirection){SortDirection["asc"]="asc";SortDirection["desc"]="desc"})(SortDirection||(SortDirection={}));const META_FIELD_NAMES=["_seq_no","_doc","_uid"];function getFirstSortableField(indexPattern,fieldNames){const sortableFields=fieldNames.filter(fieldName=>META_FIELD_NAMES.includes(fieldName)||(indexPattern.fields.getByName(fieldName)||{sortable:false}).sortable);return sortableFields[0]}function reverseSortDir(sortDirection){return sortDirection===SortDirection.asc?SortDirection.desc:SortDirection.asc}var external_osdSharedDeps_Moment_=__webpack_require__(62);var external_osdSharedDeps_Moment_default=__webpack_require__.n(external_osdSharedDeps_Moment_);function extractNanos(){let timeFieldValue=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";const fieldParts=timeFieldValue.split(".");const fractionSeconds=fieldParts.length===2?fieldParts[1].replace("Z",""):"";return fractionSeconds.length!==9?fractionSeconds.padEnd(9,"0"):fractionSeconds}function convertIsoToMillis(isoValue){const date=new Date(isoValue);return date.getTime()}function convertTimeValueToIso(timeValueMillis,nanosValue){if(!timeValueMillis){return null}const isoString=external_osdSharedDeps_Moment_default()(timeValueMillis).toISOString();if(!isoString){return null}else if(nanosValue!==""){return"".concat(isoString.substring(0,isoString.length-4)).concat(nanosValue,"Z")}return isoString}async function fetchHitsInInterval(searchSource,timeField,sort,sortDir,interval,searchAfter,maxCount,nanosValue,anchorId){var _response$hits;const range={format:"strict_date_optional_time"};const[start,stop]=interval;if(start){range[sortDir===data_public_["SortDirection"].asc?"gte":"lte"]=convertTimeValueToIso(start,nanosValue)}if(stop){range[sortDir===data_public_["SortDirection"].asc?"lte":"gte"]=convertTimeValueToIso(stop,nanosValue)}const response=await searchSource.setField("size",maxCount).setField("query",{query:{bool:{must:{constant_score:{filter:{range:{[timeField]:range}}}},must_not:{ids:{values:[anchorId]}}}},language:"lucene"}).setField("searchAfter",searchAfter).setField("sort",sort).setField("version",true).fetch();return((_response$hits=response.hits)===null||_response$hits===void 0?void 0:_response$hits.hits)||[]}function*asPairs(iterable){let currentPair=[];for(const value of iterable){currentPair=[...currentPair,value].slice(-2);if(currentPair.length===2){yield currentPair}}}function generateIntervals(offsets,startTime,type,sort){const offsetSign=sort===data_public_["SortDirection"].asc&&type==="successors"||sort===data_public_["SortDirection"].desc&&type==="predecessors"?1:-1;return asPairs([...offsets.map(offset=>startTime+offset*offsetSign),null])}function getOpenSearchQuerySearchAfter(type,documents,timeFieldName,anchor,nanoSeconds){if(documents.length){const afterTimeRecIdx=type==="successors"&&documents.length?documents.length-1:0;const afterTimeDoc=documents[afterTimeRecIdx];const afterTimeValue=nanoSeconds?afterTimeDoc._source[timeFieldName]:afterTimeDoc.sort[0];return[afterTimeValue,afterTimeDoc.sort[1]]}return[nanoSeconds?anchor._source[timeFieldName]:anchor.sort[0],anchor.sort[1]]}function getOpenSearchQuerySort(timeField,tieBreakerField,sortDir){return[{[timeField]:sortDir},{[tieBreakerField]:sortDir}]}let SurrDocType;(function(SurrDocType){SurrDocType["SUCCESSORS"]="successors";SurrDocType["PREDECESSORS"]="predecessors"})(SurrDocType||(SurrDocType={}));const DAY_MILLIS=24*60*60*1e3;const LOOKUP_OFFSETS=[0,1,7,30,365,1e4].map(days=>days*DAY_MILLIS);async function fetchSurroundingDocs(type,indexPattern,anchor,tieBreakerField,sortDir,size,filters){if(typeof anchor!=="object"||anchor===null||!size){return[]}const timeField=indexPattern.timeFieldName;const searchSource=await createSearchSource(indexPattern,filters);const sortDirToApply=type==="successors"?sortDir:reverseSortDir(sortDir);const nanos=indexPattern.isTimeNanosBased()?extractNanos(anchor._source[timeField]):"";const timeValueMillis=nanos!==""?convertIsoToMillis(anchor._source[timeField]):anchor.sort[0];const intervals=generateIntervals(LOOKUP_OFFSETS,timeValueMillis,type,sortDir);let documents=[];for(const interval of intervals){const remainingSize=size-documents.length;if(remainingSize<=0){break}const searchAfter=getOpenSearchQuerySearchAfter(type,documents,timeField,anchor,nanos);const sort=getOpenSearchQuerySort(timeField,tieBreakerField,sortDirToApply);const hits=await fetchHitsInInterval(searchSource,timeField,sort,sortDirToApply,interval,searchAfter,remainingSize,nanos,anchor._id);documents=type==="successors"?[...documents,...hits]:[...hits.slice().reverse(),...documents]}return documents}async function createSearchSource(indexPattern,filters){const{data:data}=Object(opensearch_dashboards_services["f"])();const searchSource=await data.search.searchSource.create();return searchSource.setParent(undefined).setField("index",indexPattern).setField("filter",filters)}let LOADING_STATUS;(function(LOADING_STATUS){LOADING_STATUS["LOADING"]="loading";LOADING_STATUS["LOADED"]="loaded";LOADING_STATUS["FAILED"]="failed";LOADING_STATUS["UNINITIALIZED"]="uninitialized"})(LOADING_STATUS||(LOADING_STATUS={}));let FAILURE_REASONS;(function(FAILURE_REASONS){FAILURE_REASONS["UNKNOWN"]="unknown";FAILURE_REASONS["INVALID_TIEBREAKER"]="invalid_tiebreaker"})(FAILURE_REASONS||(FAILURE_REASONS={}));const initialState={anchor:{},predecessors:[],successors:[],anchorStatus:{value:LOADING_STATUS.UNINITIALIZED},predecessorsStatus:{value:LOADING_STATUS.UNINITIALIZED},successorsStatus:{value:LOADING_STATUS.UNINITIALIZED}};function useQueryActions(anchorId,indexPattern){const{services:services}=Object(public_["useOpenSearchDashboards"])();const{data:data,uiSettings:uiSettings,toastNotifications:toastNotifications}=services;const searchSource=Object(external_osdSharedDeps_React_["useMemo"])(()=>data.search.searchSource.createEmpty(),[data.search.searchSource]);const tieBreakerField=Object(external_osdSharedDeps_React_["useMemo"])(()=>getFirstSortableField(indexPattern,uiSettings.get(common["c"])),[uiSettings,indexPattern]);const[contextQueryState,setContextQueryState]=Object(external_osdSharedDeps_React_["useState"])(initialState);const fetchAnchorRow=Object(external_osdSharedDeps_React_["useCallback"])(async()=>{if(!tieBreakerField){setContextQueryState(prevState=>({...prevState,anchorStatus:{value:LOADING_STATUS.FAILED,reason:FAILURE_REASONS.INVALID_TIEBREAKER}}));return}try{setContextQueryState(prevState=>({...prevState,anchorStatus:{value:LOADING_STATUS.LOADING}}));const sort=[{[indexPattern.timeFieldName]:SortDirection.desc},{[tieBreakerField]:SortDirection.desc}];const fetchAnchorResult=await fetchAnchor(anchorId,indexPattern,searchSource,sort);setContextQueryState(prevState=>({...prevState,anchor:fetchAnchorResult,anchorStatus:{value:LOADING_STATUS.LOADED}}));return fetchAnchorResult}catch(error){setContextQueryState(prevState=>({...prevState,anchorStatus:{value:LOADING_STATUS.FAILED,reason:FAILURE_REASONS.UNKNOWN}}));toastNotifications.addDanger({title:external_osdSharedDeps_OsdI18n_["i18n"].translate("discover.context.unableToLoadAnchorDocumentDescription",{defaultMessage:"Unable to fetch anchor document"}),text:"fail"})}},[anchorId,indexPattern,searchSource,tieBreakerField,toastNotifications]);const fetchSurroundingRows=Object(external_osdSharedDeps_React_["useCallback"])(async(type,count,filters,anchor)=>{try{if(type===SurrDocType.PREDECESSORS){setContextQueryState(prevState=>({...prevState,predecessorsStatus:{value:LOADING_STATUS.LOADING}}))}else{setContextQueryState(prevState=>({...prevState,successorsStatus:{value:LOADING_STATUS.LOADING}}))}const fetchedAchor=anchor||contextQueryState.anchor;const rows=await fetchSurroundingDocs(type,indexPattern,fetchedAchor,tieBreakerField,SortDirection.desc,count,filters);if(type===SurrDocType.PREDECESSORS){setContextQueryState(prevState=>({...prevState,predecessors:rows,predecessorsStatus:{value:LOADING_STATUS.LOADED}}))}else{setContextQueryState(prevState=>({...prevState,successors:rows,successorsStatus:{value:LOADING_STATUS.LOADED}}))}}catch(error){if(type===SurrDocType.PREDECESSORS){setContextQueryState(prevState=>({...prevState,predecessorsStatus:{value:LOADING_STATUS.FAILED,reason:FAILURE_REASONS.UNKNOWN}}))}else{setContextQueryState(prevState=>({...prevState,successorsStatus:{value:LOADING_STATUS.FAILED,reason:FAILURE_REASONS.UNKNOWN}}))}toastNotifications.addDanger({title:external_osdSharedDeps_OsdI18n_["i18n"].translate("discover.context.unableToLoadSurroundingDocumentDescription",{defaultMessage:"Unable to fetch surrounding documents"}),text:"fail"})}},[contextQueryState.anchor,indexPattern,tieBreakerField,toastNotifications]);const fetchContextRows=Object(external_osdSharedDeps_React_["useCallback"])(async(predecessorCount,successorCount,filters,anchor)=>Promise.all([fetchSurroundingRows(SurrDocType.PREDECESSORS,predecessorCount,filters,anchor),fetchSurroundingRows(SurrDocType.SUCCESSORS,successorCount,filters,anchor)]),[fetchSurroundingRows]);const fetchAllRows=Object(external_osdSharedDeps_React_["useCallback"])(async(predecessorCount,successorCount,filters)=>{try{await fetchAnchorRow().then(anchor=>anchor&&fetchContextRows(predecessorCount,successorCount,filters,anchor))}catch(error){toastNotifications.addDanger({title:external_osdSharedDeps_OsdI18n_["i18n"].translate("discover.context.unableToLoadDocumentDescription",{defaultMessage:"Unable to fetch all documents"}),text:"fail"})}},[fetchAnchorRow,fetchContextRows,toastNotifications]);const resetContextQueryState=Object(external_osdSharedDeps_React_["useCallback"])(()=>{setContextQueryState(initialState)},[]);return{contextQueryState:contextQueryState,fetchAnchorRow:fetchAnchorRow,fetchAllRows:fetchAllRows,fetchContextRows:fetchContextRows,fetchSurroundingRows:fetchSurroundingRows,resetContextQueryState:resetContextQueryState}}function ActionBarWarning(_ref){let{docCount:docCount,type:type}=_ref;if(type==="predecessors"){return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning","data-test-subj":"predecessorsWarningMsg",iconType:"bolt",title:docCount===0?external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.context.newerDocumentsWarningZero",defaultMessage:"No documents newer than the anchor could be found."}):external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.context.newerDocumentsWarning",defaultMessage:"Only {docCount} documents newer than the anchor could be found.",values:{docCount:docCount}}),size:"s"})}return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning","data-test-subj":"successorsWarningMsg",iconType:"bolt",title:docCount===0?external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.context.olderDocumentsWarningZero",defaultMessage:"No documents older than the anchor could be found."}):external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.context.olderDocumentsWarning",defaultMessage:"Only {docCount} documents older than the anchor could be found.",values:{docCount:docCount}}),size:"s"})}const MAX_CONTEXT_SIZE=1e4;const MIN_CONTEXT_SIZE=0;function ActionBar(_ref){let{defaultStepSize:defaultStepSize,docCount:docCount,docCountAvailable:docCountAvailable,isDisabled:isDisabled,isLoading:isLoading,onChangeCount:onChangeCount,type:type}=_ref;const showWarning=!isDisabled&&!isLoading&&docCountAvailable<docCount;const isSuccessor=type==="successors";const[newDocCount,setNewDocCount]=Object(external_osdSharedDeps_React_["useState"])(docCount);const isValid=value=>value>=MIN_CONTEXT_SIZE&&value<=MAX_CONTEXT_SIZE;const onSubmit=ev=>{ev.preventDefault();if(newDocCount!==docCount&&isValid(newDocCount)){onChangeCount(type,newDocCount)}};Object(external_osdSharedDeps_React_["useEffect"])(()=>{if(newDocCount!==docCount&&newDocCount===0){setNewDocCount(docCount)}},[docCount,newDocCount]);return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["I18nProvider"],null,external_osdSharedDeps_React_default.a.createElement("form",{onSubmit:onSubmit},isSuccessor&&external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),isSuccessor&&showWarning&&external_osdSharedDeps_React_default.a.createElement(ActionBarWarning,{docCount:docCountAvailable,type:type}),isSuccessor&&showWarning&&external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"row",gutterSize:"s",responsive:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":"".concat(type,"LoadMoreButton"),iconType:isSuccessor?"arrowDown":"arrowUp",isDisabled:isDisabled,isLoading:isLoading,onClick:()=>{const value=newDocCount+defaultStepSize;if(isValid(value)){setNewDocCount(value);onChangeCount(type,value)}},flush:"right"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.context.loadButtonLabel",defaultMessage:"Load"}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":isSuccessor?external_osdSharedDeps_OsdI18n_["i18n"].translate("discover.context.olderDocumentsAriaLabel",{defaultMessage:"Number of older documents"}):external_osdSharedDeps_OsdI18n_["i18n"].translate("discover.context.newerDocumentsAriaLabel",{defaultMessage:"Number of newer documents"}),className:"cxtSizePicker","data-test-subj":"".concat(type,"CountPicker"),disabled:isDisabled,min:MIN_CONTEXT_SIZE,max:MAX_CONTEXT_SIZE,onChange:ev=>{setNewDocCount(ev.target.valueAsNumber)},onBlur:()=>{if(newDocCount!==docCount&&isValid(newDocCount)){onChangeCount(type,newDocCount)}},type:"number",value:newDocCount>=0?newDocCount:""}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],{display:"center"},isSuccessor?external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.context.olderDocumentsDescription",defaultMessage:"older documents"}):external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"discover.context.newerDocumentsDescription",defaultMessage:"newer documents"})))),!isSuccessor&&showWarning&&external_osdSharedDeps_React_default.a.createElement(ActionBarWarning,{docCount:docCountAvailable,type:type}),!isSuccessor&&external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})))}var data_grid_table=__webpack_require__(80);function ContextApp(_ref){let{onAddFilter:onAddFilter,rows:rows,indexPattern:indexPattern,setAppState:setAppState,contextQueryState:contextQueryState,appState:appState}=_ref;const{services:services}=Object(public_["useOpenSearchDashboards"])();const{uiSettings:uiSettings}=services;const defaultStepSize=Object(external_osdSharedDeps_React_["useMemo"])(()=>parseInt(uiSettings.get(common["b"]),10),[uiSettings]);const{columns:columns,predecessorCount:predecessorCount,successorCount:successorCount}=appState;const{anchorStatus:anchorStatus,predecessorsStatus:predecessorsStatus,successorsStatus:successorsStatus,predecessors:predecessors,successors:successors}=contextQueryState;const isAnchorLoading=anchorStatus.value===LOADING_STATUS.LOADING||anchorStatus.value===LOADING_STATUS.UNINITIALIZED;const isPredecessorLoading=predecessorsStatus.value===LOADING_STATUS.LOADING||predecessorsStatus.value===LOADING_STATUS.UNINITIALIZED;const isSuccessorLoading=successorsStatus.value===LOADING_STATUS.LOADING||successorsStatus.value===LOADING_STATUS.UNINITIALIZED;const onChangeCount=Object(external_osdSharedDeps_React_["useCallback"])((type,count)=>{const countType=type===SurrDocType.SUCCESSORS?"successorCount":"predecessorCount";if(countType==="successorCount"){setAppState({successorCount:count})}else{setAppState({predecessorCount:count})}},[setAppState]);const sort=Object(external_osdSharedDeps_React_["useMemo"])(()=>[[indexPattern.timeFieldName,data_public_["SortDirection"].desc]],[indexPattern]);const displayTimeColumn=Object(external_osdSharedDeps_React_["useMemo"])(()=>!uiSettings.get(common["e"],false)&&(indexPattern===null||indexPattern===void 0?void 0:indexPattern.isTimeBased()),[indexPattern,uiSettings]);return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_["Fragment"],null,external_osdSharedDeps_React_default.a.createElement(ActionBar,{defaultStepSize:defaultStepSize,docCount:predecessorCount,docCountAvailable:predecessors.length,isDisabled:isAnchorLoading,isLoading:isPredecessorLoading,onChangeCount:onChangeCount,type:SurrDocType.PREDECESSORS}),external_osdSharedDeps_React_default.a.createElement("div",{className:"dscDocsGrid"},external_osdSharedDeps_React_default.a.createElement(data_grid_table["a"],{"aria-label":"ContextTable",columns:columns,indexPattern:indexPattern,onAddColumn:()=>{},onFilter:onAddFilter,onRemoveColumn:()=>{},onSetColumns:()=>{},onSort:()=>{},sort:sort,rows:rows,displayTimeColumn:displayTimeColumn,services:services,isToolbarVisible:false,isContextView:true})),external_osdSharedDeps_React_default.a.createElement(ActionBar,{defaultStepSize:defaultStepSize,docCount:successorCount,docCountAvailable:successors.length,isDisabled:isAnchorLoading,isLoading:isSuccessorLoading,onChangeCount:onChangeCount,type:SurrDocType.SUCCESSORS}))}const SurroundingDocsView=_ref=>{let{id:id,indexPattern:indexPattern}=_ref;const{services:services}=Object(public_["useOpenSearchDashboards"])();const{navigation:{ui:{TopNavMenu:TopNavMenu}},data:{query:{filterManager:filterManager}}}=services;const{contextAppState:contextAppState,setContextAppState:setContextAppState}=useContextState({services:services,indexPattern:indexPattern});const currentAppState=Object(external_osdSharedDeps_React_["useRef"])();const{contextQueryState:contextQueryState,fetchContextRows:fetchContextRows,fetchAllRows:fetchAllRows,fetchSurroundingRows:fetchSurroundingRows,resetContextQueryState:resetContextQueryState}=useQueryActions(id,indexPattern);const isLoading=[contextQueryState.anchorStatus.value,contextQueryState.predecessorsStatus.value,contextQueryState.successorsStatus.value].some(status=>status===LOADING_STATUS.LOADING||status===LOADING_STATUS.UNINITIALIZED);const rows=Object(external_osdSharedDeps_React_["useMemo"])(()=>[...contextQueryState.predecessors||[],...contextQueryState.anchor?[contextQueryState.anchor]:[],...contextQueryState.successors||[]],[contextQueryState.predecessors,contextQueryState.anchor,contextQueryState.successors]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{if(currentAppState.current){currentAppState.current=undefined;resetContextQueryState()}},[id,resetContextQueryState]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{const{predecessorCount:predecessorCount,successorCount:successorCount,filters:filters}=contextAppState;if(!currentAppState.current){fetchAllRows(predecessorCount,successorCount,filters)}else if(currentAppState.current.predecessorCount!==predecessorCount){fetchSurroundingRows(SurrDocType.PREDECESSORS,predecessorCount,filters)}else if(currentAppState.current.successorCount!==successorCount){fetchSurroundingRows(SurrDocType.SUCCESSORS,successorCount,filters)}else if(!isEqualFilters(currentAppState.current.filters,filters)){fetchContextRows(contextAppState.predecessorCount,successorCount,filters)}currentAppState.current=Object(external_osdSharedDeps_Lodash_["cloneDeep"])(contextAppState)},[contextAppState,id,fetchContextRows,fetchAllRows,fetchSurroundingRows]);const onAddFilter=Object(external_osdSharedDeps_React_["useCallback"])((field,values,operation)=>{const newFilters=data_public_["opensearchFilters"].generateFilters(filterManager,field,values,operation,indexPattern.id||"");return filterManager.addFilters(newFilters)},[filterManager,indexPattern]);const contextAppMemoized=Object(external_osdSharedDeps_React_["useMemo"])(()=>external_osdSharedDeps_React_default.a.createElement(ContextApp,{onAddFilter:onAddFilter,rows:rows,indexPattern:indexPattern,setAppState:setContextAppState,contextQueryState:contextQueryState,appState:contextAppState}),[onAddFilter,rows,indexPattern,setContextAppState,contextQueryState,contextAppState]);if(isLoading){return null}return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_["Fragment"],null,external_osdSharedDeps_React_default.a.createElement(TopNavMenu,{appName:"discover.context.surroundingDocs.topNavMenu",showSearchBar:true,showQueryBar:false,showDatePicker:false,indexPatterns:[indexPattern],useDefaultBehaviors:true}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPage"],{className:"discover.context.appPage"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPageContent"],{paddingSize:"s",className:"dscDocsContent"},contextAppMemoized)))};function SurroundingDocsApp(){const{services:{chrome:chrome,indexPatterns:indexPatterns,core:{application:{getUrlForApp:getUrlForApp}}}}=Object(public_["useOpenSearchDashboards"])();const baseUrl=getUrlForApp(common["g"]);const{id:id,indexPatternId:indexPatternId}=Object(external_osdSharedDeps_ReactRouterDom_["useParams"])();const[indexPattern,setIndexPattern]=Object(external_osdSharedDeps_React_["useState"])(undefined);const[error,setError]=Object(external_osdSharedDeps_React_["useState"])(null);Object(external_osdSharedDeps_React_["useEffect"])(()=>{async function getIndexPatternById(){try{const ip=await indexPatterns.get(indexPatternId);setIndexPattern(ip)}catch(e){setError(e)}}getIndexPatternById()},[indexPatternId,indexPatterns]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{chrome.setBreadcrumbs([...Object(breadcrumbs["a"])(),{text:external_osdSharedDeps_OsdI18n_["i18n"].translate("discover.context.breadcrumb",{defaultMessage:"Context of #{docId}",values:{docId:id}})}])},[id,chrome,baseUrl]);if(error){return external_osdSharedDeps_React_default.a.createElement("div",null,"Error fetching index pattern: ",error.message)}if(!indexPattern){return external_osdSharedDeps_React_default.a.createElement("div",null,"Index pattern loading")}return external_osdSharedDeps_React_default.a.createElement(SurroundingDocsView,{id:id,indexPattern:indexPattern})}const docViewsRouter=history=>{const services=Object(opensearch_dashboards_services["f"])();if(services===undefined)return external_osdSharedDeps_React_default.a.createElement("div",null,"loading...");return external_osdSharedDeps_React_default.a.createElement(public_["OpenSearchDashboardsContextProvider"],{services:services},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Router"],{history:history},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Switch"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Route"],{path:"/context/:indexPatternId/:id",component:SurroundingDocsApp}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Route"],{path:"/doc/:indexPattern/:index/:type",render:props=>external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Redirect"],{to:"/doc/".concat(props.match.params.indexPattern,"/").concat(props.match.params.index)})}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Route"],{path:"/doc/:indexPatternId/:index",component:SingleDocApp}))))};const renderDocView=element=>{const{history:history}=Object(opensearch_dashboards_services["f"])();const unmount=Object(public_["toMountPoint"])(docViewsRouter(history()))(element);return unmount}},74:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getRootBreadcrumbs}));var _osd_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);var _osd_i18n__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_osd_i18n__WEBPACK_IMPORTED_MODULE_0__);var _opensearch_dashboards_services__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5);function getRootBreadcrumbs(){const{core:core}=Object(_opensearch_dashboards_services__WEBPACK_IMPORTED_MODULE_1__["f"])();return[{text:_osd_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("discover.rootBreadcrumb",{defaultMessage:"Discover"}),onClick:()=>core.application.navigateToApp("discover")}]}}}]);