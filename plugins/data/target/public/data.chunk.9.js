(window["data_bundle_jsonpfunction"]=window["data_bundle_jsonpfunction"]||[]).push([[9],{168:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return ShardFailureOpenModalButton}));var external_osdSharedDeps_React_=__webpack_require__(3);var external_osdSharedDeps_React_default=__webpack_require__.n(external_osdSharedDeps_React_);var external_osdSharedDeps_OsdI18nReact_=__webpack_require__(41);var external_osdSharedDeps_ElasticEui_=__webpack_require__(21);var services=__webpack_require__(8);var public_=__webpack_require__(20);var external_osdSharedDeps_OsdI18n_=__webpack_require__(0);var external_osdSharedDeps_ElasticEuiLibServices_=__webpack_require__(158);function shouldReadKeys(value){return typeof value==="object"&&value!==null&&!Array.isArray(value)}function getFlattenedObject(rootValue){if(!shouldReadKeys(rootValue)){throw new TypeError("Root value is not flatten-able, received ".concat(rootValue))}const result={};(function flatten(prefix,object){for(const[key,value]of Object.entries(object)){const path=prefix?"".concat(prefix,".").concat(key):key;if(shouldReadKeys(value)){flatten(path,value)}else{result[path]=value}}})("",rootValue);return result}function getFailurePropsForSummary(failure){const failureDetailProps=["shard","index","node"];return failureDetailProps.filter(key=>typeof failure[key]==="number"||typeof failure[key]==="string").map(key=>({key:key,value:String(failure[key])}))}function getFailureSummaryText(failure,failureDetails){const failureName=failure.reason.type;const displayDetails=typeof failureDetails==="string"?failureDetails:getFailureSummaryDetailsText(failure);return external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.failureHeader",{defaultMessage:"{failureName} at {failureDetails}",values:{failureName:failureName,failureDetails:displayDetails},description:'Summary of shard failures, e.g. "IllegalArgumentException at shard 0 node xyz"'})}function getFailureSummaryDetailsText(failure){return getFailurePropsForSummary(failure).map(_ref=>{let{key:key,value:value}=_ref;return"".concat(key,": ").concat(value)}).join(", ")}function ShardFailureDescriptionHeader(props){const failureDetails=getFailurePropsForSummary(props).map(kv=>external_osdSharedDeps_React_default.a.createElement("span",{className:"shardFailureModal__keyValueTitle",key:kv.key},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCode"],null,kv.key)," ",kv.value));return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,getFailureSummaryText(props,""),failureDetails))}function formatKey(key){const nameCapitalized=key.charAt(0).toUpperCase()+key.slice(1);return nameCapitalized.replace(/[\._]/g," ")}function formatValueByKey(value,key){if(key==="script"||key==="script_stack"){const valueScript=Array.isArray(value)?value.join("\n"):String(value);return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"java",paddingSize:"s",isCopyable:true},valueScript)}else{return String(value)}}function ShardFailureDescription(props){const flattendReason=getFlattenedObject(props.reason);const listItems=Object.entries(flattendReason).map(_ref=>{let[key,value]=_ref;return{title:formatKey(key),description:formatValueByKey(value,key)}});return external_osdSharedDeps_React_default.a.createElement("div",null,external_osdSharedDeps_React_default.a.createElement(ShardFailureDescriptionHeader,props),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiDescriptionList"],{listItems:listItems,type:"column",compressed:true,className:"shardFailureModal__desc",titleProps:{className:"shardFailureModal__descTitle"},descriptionProps:{className:"shardFailureModal__descValue"}}))}function ShardFailureTable(_ref){let{failures:failures}=_ref;const itemList=failures.map((failure,idx)=>({...{id:String(idx)},...failure}));const initalMap={};const[expandMap,setExpandMap]=Object(external_osdSharedDeps_React_["useState"])(initalMap);const columns=[{align:external_osdSharedDeps_ElasticEuiLibServices_["RIGHT_ALIGNMENT"],width:"40px",isExpander:true,render:item=>{const failureSummeryText=getFailureSummaryText(item);const collapseLabel=external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tableRowCollapse",{defaultMessage:"Collapse {rowDescription}",description:"Collapse a row of a table with failures",values:{rowDescription:failureSummeryText}});const expandLabel=external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tableRowExpand",{defaultMessage:"Expand {rowDescription}",description:"Expand a row of a table with failures",values:{rowDescription:failureSummeryText}});return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>{const map=Object.assign({},expandMap);if(map[item.id]){delete map[item.id]}else{map[item.id]=external_osdSharedDeps_React_default.a.createElement(ShardFailureDescription,item)}setExpandMap(map)},"aria-label":expandMap[item.id]?collapseLabel:expandLabel,iconType:expandMap[item.id]?"arrowUp":"arrowDown"})}},{field:"shard",name:external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tableColShard",{defaultMessage:"Shard"}),sortable:true,truncateText:true,width:"80px"},{field:"index",name:external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tableColIndex",{defaultMessage:"Index"}),sortable:true,truncateText:true},{field:"node",name:external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tableColNode",{defaultMessage:"Node"}),sortable:true,truncateText:true},{field:"reason.type",name:external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tableColReason",{defaultMessage:"Reason"}),truncateText:true}];return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiInMemoryTable"],{itemId:"id",items:itemList,columns:columns,pagination:true,sorting:{sort:{field:"index",direction:"desc"}},itemIdToExpandedRowMap:expandMap})}function ShardFailureModal(_ref){let{request:request,response:response,title:title,onClose:onClose}=_ref;if(!response||!response._shards||!Array.isArray(response._shards.failures)||!request){return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCallOut"],{title:"Sorry, there was an error",color:"danger",iconType:"alert"},"The ShardFailureModal component received invalid properties")}const failures=response._shards.failures;const requestJSON=JSON.stringify(request,null,2);const responseJSON=JSON.stringify(response,null,2);const tabs=[{id:"table",name:external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tabHeaderShardFailures",{defaultMessage:"Shard failures",description:"Name of the tab displaying shard failures"}),content:external_osdSharedDeps_React_default.a.createElement(ShardFailureTable,{failures:failures})},{id:"json-request",name:external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tabHeaderRequest",{defaultMessage:"Request",description:"Name of the tab displaying the JSON request"}),content:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"json",isCopyable:true},requestJSON)},{id:"json-response",name:external_osdSharedDeps_OsdI18n_["i18n"].translate("data.search.searchSource.fetch.shardsFailedModal.tabHeaderResponse",{defaultMessage:"Response",description:"Name of the tab displaying the JSON response"}),content:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"json",isCopyable:true},responseJSON)}];return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_default.a.Fragment,null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiModalHeader"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,title)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiModalBody"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTabbedContent"],{tabs:tabs,initialSelectedTab:tabs[0],autoFocus:"selected"})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiModalFooter"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCopy"],{textToCopy:responseJSON},copy=>external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:copy},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"data.search.searchSource.fetch.shardsFailedModal.copyToClipboard",defaultMessage:"Copy response to clipboard"}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButton"],{onClick:()=>onClose(),fill:true,"data-test-sub":"closeShardFailureModal"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"data.search.searchSource.fetch.shardsFailedModal.close",defaultMessage:"Close",description:"Closing the Modal"}))))}function ShardFailureOpenModalButton(_ref){let{request:request,response:response,title:title}=_ref;function onClick(){const modal=Object(services["d"])().openModal(Object(public_["toMountPoint"])(external_osdSharedDeps_React_default.a.createElement(ShardFailureModal,{request:request,response:response,title:title,onClose:()=>modal.close()})),{className:"shardFailureModal"})}return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTextAlign"],{textAlign:"right"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButton"],{color:"warning",size:"s",onClick:onClick,"data-test-subj":"openShardFailureModalBtn"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"data.search.searchSource.fetch.shardsFailedModal.showDetails",defaultMessage:"Show details",description:"Open the modal to show details"})))}}}]);